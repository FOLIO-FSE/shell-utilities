records-get inventory
records-get locations
records-get mattypes 

jq -r '[.id, .code]|@tsv' locations.json > location.tsv
jq -r '[.id, .name]|@tsv' mattypes.json > mattype.tsv

echo -e "call_prefix\tcall_num\tcall_suffix\ttitle\tbarcode\tlocation\tmattype\tstatus\tsuppress" > item_report.tsv

cat inventory.json |jq -r --arg delim $'\x1f' '
	.instance.title as $title |
	if (.items != null) then
		.items[] 
		else empty
		end |
	[
	"\(.effectiveCallNumberComponents.prefix)" // "",
	"\(.effectiveCallNumberComponents.callNumber)" // "no call number",
	"\(.effectiveCallNumberComponents.suffix)" // "",
	$title,
	"\(.barcode)" // "no barcode",
	"\(.effectiveLocationId)" // "",
	"\(.materialTypeId)" // "",
	"\(.status.name)" // "",
	"\(.discoverySuppress)" // ""
	] | join($delim)
	' | tr $'\x1f' '\t' |sed 's/^ *//;s/ *\t */\t/g;s/^null\t/\t/;s/\tnull$/\t/;s/\tnull\t/\t\t/g' |sort >> item_report.tsv 

value-mapper item_report.tsv


# Supply without a uuid to delete all of many record types
# 
tenant=$(cat tenant)
okapi_url=$(cat okapi.url)
okapi_token=$(cat okapi.token)

deletetype=$1
deletefile="delete"
numrecs=$(wc -l ${deletefile} |cut -d " " -f1)

case $deletetype in
"campuses")
	recordtype="location-units/campuses"
	;;
"groups")
	recordtype="groups"
	;;
"holdings")
	recordtype="holdings-storage/holdings"
	;;
"instances")
	recordtype="instance-storage/instances"
	;;
"instance-types")
	recordtype="instance-types"
	;;
"items")
	recordtype="item-storage/items"
	;;
"libraries")
	recordtype="location-units/libraries"
	;;
"locations")
	recordtype="locations"
	;;
"notices")
	recordtype="scheduled-notice-storage/scheduled-notices"
	;;
"organizations")
	recordtype="organizations/organizations"
	;;
"requests")
	recordtype="circulation/requests"
	;;
"servicepoints")
	recordtype="service-points"
	;;
"users")
	recordtype="users"
	;;
"tags")
	recordtype="tags"
	;;
*)
	echo "Record type '${deletetype}' not found. Supported types are campuses, groups, holdings, instances, instance-types, items, libraries, locations, notices, organizations, requests, servicepoints, users, tags. Objects with attached records will need specialized delete routines"
	exit
	;;
esac

counter=1

while read -r uuid; do
	uuid=${uuid//[^0-9a-z\-]/}
	echo "${okapi_url}/${recordtype}/${uuid}"
	apicall=$(curl -s -w '\n' -X DELETE -D -H "Accept: application/json" -H "X-Okapi-Tenant: ${tenant}" -H "x-okapi-token: ${okapi_token}" "${okapi_url}/${recordtype}/${uuid}")
	echo "Processing record $counter of $numrecs")
	counter=$(($counter + 1))
	echo ${apicall}
done < ${deletefile}

